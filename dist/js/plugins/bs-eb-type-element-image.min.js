/*!
Bootstrap Email Builder v0.0.1
Copyright (c) 161 SARL, http://161.io
License: https://github.com/161io/bootstrap-email-builder/blob/master/license.txt
 */
(function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;b=window,a=b.BsEbConstant,b.BsEbTypeElementImage=function(e){function f(){return this.onMore=c(this.onMore,this),f.__super__.constructor.apply(this,arguments)}return d(f,e),f.tabButton=function(){return'<div class="col-xs-6">\n<a class="btn btn-lg btn-block btn-default" data-draggable-type="elt-image">\n    <span class="glyphicon glyphicon-picture"></span><br/>\n    <span>'+a.translate("Image")+"</span>\n</a>\n</div>"},f.prototype.defaultSrc="",f.prototype.defaultAlt="image",f.prototype.defaultWidth="",f.prototype.defaultHeight="",f.prototype.defaultStyle="border:0 none;",f.prototype.responsiveFilemanagerIframe="",f.prototype.buildHtml=function(b,c,d){return d||(d='<div class="'+a.CLASS_NAME_ELEMENT_CONTENT+'" data-type="'+c+'">\n<img src="'+this.defaultSrc+'" alt="'+this.defaultAlt+'" border="0" style="'+this.defaultStyle+'" width="'+this.defaultWidth+'" height="'+this.defaultHeight+'"/>\n</div>'),f.__super__.buildHtml.call(this,b,c,d)},f.prototype.events=function(){return this.$element.on("bseb-elt-more",this.onMore),this},f.prototype.onMore=function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;return m=this.responsiveFilemanagerIframe,!m&&b.tinyMCE&&tinyMCE.settings.external_filemanager_path&&(m=tinyMCE.settings.external_filemanager_path+"dialog.php?type=1&field_id=bs-eb-src",tinyMCE.settings.filemanager_access_key&&(m+="&akey="+tinyMCE.settings.filemanager_access_key)),g=function(a){return a=parseInt(a),isNaN(a)||a<1?"":a},n=this,c=this.$element.find("a").first(),d=this.$element.find("img").first(),o=a.escape(d.attr("src")),p=g(d.attr("width")),h=g(d.attr("height")),f=a.escape(d.attr("alt")),j="block"===d.css("display"),i=a.escape(c.attr("href")),k=new b.BsEbModal({title:a.translate("Content")+" : "+a.translate("Image"),body:'<div class="form-group">\n    <code class="pull-right">src=&quot;...&quot;</code>\n    <label for="bs-eb-src">'+a.translate("Source")+'</label>\n    <div class="input-group">\n        <input type="text" id="bs-eb-src" value="'+o+'" placeholder="https:// ... image.jpg" class="form-control"/>\n        <span class="input-group-btn"><button class="btn btn-default" type="button" id="bs-eb-src-browse">'+a.translate("Browse")+'</button></span>\n    </div>\n</div>\n<div class="form-group">\n    <code class="pull-right">alt=&quot;...&quot;</code>\n    <label for="bs-eb-alt">'+a.translate("Image description")+'</label>\n    <input type="text" id="bs-eb-alt" value="'+f+'" class="form-control" maxlength="50"/>\n</div>\n<div class="form-group">\n    <code class="pull-right">width=&quot;...&quot; height=&quot;...&quot;</code>\n    <label for="bs-eb-width">'+a.translate("Width")+" &times; "+a.translate("Height")+'</label>\n    <div class="row">\n        <div class="col-xs-5"><input type="text" id="bs-eb-width" value="'+p+'" class="form-control" maxlength="5"/></div>\n        <div class="col-xs-2 text-center"><button type="button" class="btn btn-default btn-block active" id="bs-eb-btn-ratio"><span class="glyphicon glyphicon-transfer"></span></button></div>\n        <div class="col-xs-5"><input type="text" id="bs-eb-height" value="'+h+'" class="form-control" maxlength="5"/></div>\n    </div>\n</div>\n<div class="checkbox">\n    <label><input type="checkbox" id="bs-eb-block"'+(j?' checked="checked"':"")+"/>\n    "+a.translate("Image as a block")+' <code>&quot;display:block&quot;</code></label>\n</div>\n<hr/>\n<div class="form-group">\n    <code class="pull-right">href=&quot;...&quot;</code>\n    <label for="bs-eb-href">'+a.translate("Url")+'</label>\n    <input type="url" id="bs-eb-href" value="'+i+'" placeholder="https://..." class="form-control"/>\n</div>',btnOkClick:function(){var a,b,e,f;return k.hide(),a=$("#bs-eb-href").val(),a?c.length?c.attr("href",a):d.wrap('<a href="'+a+'" target="_blank"></a>'):c.length&&(d.appendTo(c.parent()),c.remove()),f=g($("#bs-eb-width").val()),b=g($("#bs-eb-height").val()),e=$("#bs-eb-block").prop("checked"),d.attr({src:$("#bs-eb-src").val(),alt:$("#bs-eb-alt").val(),width:f,height:b}).css({display:e?"block":"",border:"0 none",width:f,height:b})},modalReady:function(){return $("#bs-eb-src-browse").on("click",function(){var a;return m?(a=$.featherlight('<iframe src="'+m+'" width="900" height="600" frameborder="0" style="border:none;"></iframe>',{}),b.responsive_filemanager_callback=function(b){return n.detectSize(),a.close(),setTimeout(function(){return k.show()},500)}):void $.featherlight('<div class="lead" style="padding:40px 30px 20px;">RESPONSIVE filemanager was not found.</div>')})}}),l=p>0&&h>0?p/h:1,e=$("#bs-eb-src"),e.on("change blur",this.detectSize).data("ratio",l).data("prevVal",e.val()),this.ratioTool(),this},f.prototype.ratioTool=function(){var a,b,c,d,e;return c=$("#bs-eb-src"),d=$("#bs-eb-width"),b=$("#bs-eb-height"),a=$("#bs-eb-btn-ratio"),e=function(e){var f,g,h;null==e&&(e="width"),a.hasClass("active")&&(h=parseInt(d.val()),f=parseInt(b.val()),g=c.data("ratio"),(isNaN(h)||h<1)&&(h=0),(isNaN(f)||f<1)&&(f=0),"width"===e?(f=Math.round(h/g),f>0&&b.val(f)):(h=Math.round(f*g),h>0&&d.val(h)))},a.on("click",function(){return a.toggleClass("active"),e()}),d.on("keyup",function(){return e()}),b.on("keyup",function(){return e("height")})},f.prototype.detectSize=function(){var a,b,c,d,e,f;return c=$("#bs-eb-src"),d=$("#bs-eb-width"),a=$("#bs-eb-height"),c.parents(".form-group").removeClass("has-error"),!(!c.val()||c.val()===c.data("prevVal"))&&(c.data("ratio",1).data("prevVal",c.val()),f="bs-eb-img-detect-size",e=function(){return $("."+f).remove()},b=$('<img alt="" class="'+f+'"/>'),b.css({position:"absolute",left:"-100%",top:"-100%"}).on("load",function(){return setTimeout(function(){var f,g,h;return h=b.width(),f=b.height(),g=h>0&&f>0?h/f:1,d.val(h),a.val(f),c.data("ratio",g),e()},200)}).on("error",function(){return c.parents(".form-group").addClass("has-error"),e()}),b.attr("src",c.val()).appendTo("body"))},f}(b.AbstractBsEbTypeElement)}).call(this);